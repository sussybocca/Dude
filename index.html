<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fauxipedia â€” Firebase Auth Example</title>
<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAAwXf9R533sSoviyT3M83yawxwMsp80rg",
    authDomain: "dude-918a5.firebaseapp.com",
    projectId: "dude-918a5",
    storageBucket: "dude-918a5.firebasestorage.app",
    messagingSenderId: "210629790805",
    appId: "1:210629790805:web:3b4ae0a8612c89bb1a98dc",
    measurementId: "G-SN9X138J6W"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Elements
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const googleBtn = document.getElementById('google-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const contentDiv = document.getElementById('content');

  // Local fake articles
  const articles = [...]; // same as before, 20 articles with base text

  function makeExactWords(base, target){ /* same as before */ }
  function renderList(){ /* same as before */ }
  function showArticle(id){ /* same as before */ }

  // Signup with email/password
  signupForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = signupForm.email.value;
    const password = signupForm.password.value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      signupForm.reset();
    } catch(err){
      alert(err.message);
    }
  });

  // Login with email/password
  loginForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = loginForm.email.value;
    const password = loginForm.password.value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      loginForm.reset();
    } catch(err){
      alert(err.message);
    }
  });

  // Login with Google
  googleBtn.addEventListener('click', async ()=>{
    try {
      await signInWithPopup(auth, provider);
    } catch(err){
      alert(err.message);
    }
  });

  // Logout
  logoutBtn.addEventListener('click', async ()=>{
    await signOut(auth);
  });

  // Auth state listener
  onAuthStateChanged(auth, user => {
    if(user){
      document.getElementById('auth-section').style.display = 'none';
      contentDiv.style.display = 'flex';
      renderList();
      showArticle(1);
    } else {
      document.getElementById('auth-section').style.display = 'block';
      contentDiv.style.display = 'none';
    }
  });
</script>
<style>
/* same styles as before */
</style>
</head>
<body>
<header>Fauxipedia</header>
<div id="auth-section">
  <h3>Signup</h3>
  <form id="signup-form">
    <input name="email" placeholder="Email" type="email" required>
    <input name="password" placeholder="Password" type="password" required>
    <button type="submit">Signup</button>
  </form>
  <h3>Login</h3>
  <form id="login-form">
    <input name="email" placeholder="Email" type="email" required>
    <input name="password" placeholder="Password" type="password" required>
    <button type="submit">Login</button>
  </form>
  <button id="google-btn">Login with Google</button>
</div>
<div id="content">
  <button id="logout-btn">Logout</button>
  <div id="app">
    <nav><div id="list"></div></nav>
    <main>
      <h2 id="a-title">Select an article</h2>
      <div class="meta" id="a-meta"></div>
      <div id="a-body"></div>
    </main>
  </div>
</div>
</body>
</html>
