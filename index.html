<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fauxipedia — Firebase Auth Example</title>
<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAAwXf9R533sSoviyT3M83yawxwMsp80rg",
    authDomain: "dude-918a5.firebaseapp.com",
    projectId: "dude-918a5",
    storageBucket: "dude-918a5.firebasestorage.app",
    messagingSenderId: "210629790805",
    appId: "1:210629790805:web:3b4ae0a8612c89bb1a98dc",
    measurementId: "G-SN9X138J6W"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Elements
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const googleBtn = document.getElementById('google-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const contentDiv = document.getElementById('content');

  // Local fake articles (shortened list for example)
  const articles = [
    {id:1, title:"Cardiean Corporation", year:1776, base:"Cardiean is a legendary conglomerate founded in 1776 by John Coal. Its lore mixes hotels, gold mines, and the mythical Gold Cube valued at a trillion dollars. Over time, legends describe successors like Deshawnto, a troubled heir, who inherits both immense wealth and notoriety. This fictional article explores ambition, power, and corruption."},
    {id:2, title:"ChronoSpindle (Temporal Loom)", year:1821, base:"The ChronoSpindle was a fictional 1821 machine weaving time into thread. Tales describe artisans glimpsing past mistakes to perfect their craft. Critics warned of paradoxes, while dramatists turned it into plays. It is a morality tale on tampering with time."},
    {id:3, title:"Aetheric Telegraph", year:1839, base:"The Aetheric Telegraph, an imagined 1839 device, transmitted not only text but mood through an alleged aether medium. Poets and musicians claimed to hear emotional undertones in messages. Though mythical, it illustrates alternate communication evolution."}
  ];

  function makeExactWords(base, target){
    const fillers = [
      "The story serves as metaphorical commentary on ambition and society.",
      "Later chroniclers speculated on its broader impact.",
      "It remains purely fictional, but functions as illustration.",
      "These tales encourage reflection on values through invention."
    ];
    const baseWords = base.replace(/\s+/g,' ').trim().split(' ').filter(Boolean);
    const words = [...baseWords];
    let fi = 0;
    while(words.length < target){
      const fillerWords = fillers[fi % fillers.length].split(' ');
      for(const w of fillerWords){
        if(words.length < target) words.push(w);
      }
      fi++;
    }
    return words.slice(0, target).join(' ') + '.';
  }

  function renderList(){
    const listEl = document.getElementById('list');
    listEl.innerHTML = '';
    articles.forEach(a => {
      const it = document.createElement('div');
      it.className = 'item';
      it.innerHTML = `<div class="title">${a.title}</div><div class="meta">Year: ${a.year}</div>`;
      it.onclick = () => showArticle(a.id);
      listEl.appendChild(it);
    });
  }

  function showArticle(id){
    const a = articles.find(x => x.id === id);
    if(!a) return;
    document.getElementById('a-title').textContent = a.title;
    document.getElementById('a-meta').textContent = `Fictional entry — year ${a.year}`;
    const body = document.getElementById('a-body');
    const content = makeExactWords(a.base, 300);
    const paragraphs = content.match(/(.|\s){1,800}/g) || [content];
    body.innerHTML = paragraphs.map(p => `<p>${p}</p>`).join('');
  }

  // Signup with email/password
  signupForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = signupForm.email.value;
    const password = signupForm.password.value;
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      signupForm.reset();
    } catch(err){
      alert(err.message);
    }
  });

  // Login with email/password
  loginForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = loginForm.email.value;
    const password = loginForm.password.value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
      loginForm.reset();
    } catch(err){
      alert(err.message);
    }
  });

  // Login with Google
  googleBtn.addEventListener('click', async ()=>{
    try {
      await signInWithPopup(auth, provider);
    } catch(err){
      alert(err.message);
    }
  });

  // Logout
  logoutBtn.addEventListener('click', async ()=>{
    await signOut(auth);
  });

  // Auth state listener — controls screen switching
  onAuthStateChanged(auth, (user) => {
    if(user){
      document.getElementById("auth-section").style.display = "none";
      contentDiv.style.display = "flex";
      renderList();
      showArticle(1);
    } else {
      document.getElementById("auth-section").style.display = "block";
      contentDiv.style.display = "none";
    }
  });
</script>
<style>
body{font-family:Arial, sans-serif; margin:0; display:flex; flex-direction:column;}
header{background:#0a59a6;color:#fff;padding:10px;font-size:20px}
#auth-section{padding:20px;}
#content{display:none; flex:1;}
#app{display:flex;}
nav{width:250px; border-right:1px solid #ddd; padding:10px}
main{flex:1;padding:10px}
.item{cursor:pointer;padding:5px;margin-bottom:5px;border-radius:4px}
.item:hover{background:#eef}
</style>
</head>
<body>
<header>Fauxipedia</header>
<div id="auth-section">
  <h3>Signup</h3>
  <form id="signup-form">
    <input name="email" placeholder="Email" type="email" required>
    <input name="password" placeholder="Password" type="password" required>
    <button type="submit">Signup</button>
  </form>
  <h3>Login</h3>
  <form id="login-form">
    <input name="email" placeholder="Email" type="email" required>
    <input name="password" placeholder="Password" type="password" required>
    <button type="submit">Login</button>
  </form>
  <button id="google-btn">Login with Google</button>
</div>
<div id="content">
  <button id="logout-btn">Logout</button>
  <div id="app">
    <nav><div id="list"></div></nav>
    <main>
      <h2 id="a-title">Select an article</h2>
      <div class="meta" id="a-meta"></div>
      <div id="a-body"></div>
    </main>
  </div>
</div>
</body>
</html>